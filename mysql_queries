$doctor_sql = <<<SQL
     SELECT 
		DO.ID AS DOID,
		upperwords(DO.FIRST_NAME) AS FIRST_NAME,
		DO.MIDDLE_INITIAL,
		upperwords(DO.LAST_NAME) AS LAST_NAME,
		DO.MAIDEN_NAME,
		DO.SUFFIX,
		DO.CITIZENSHIP,
		DO.GENDER,
		DO.SPECIALITY_YEAR,		
		DE.ID,
		DE.NAME              
	FROM 
		DOCTORS AS DO  
	LEFT JOIN 
		ADDRESSES AS AD ON DO.ADDRESS_ID=AD.ID 
    LEFT JOIN
        DEGREES AS DE ON DO.DEGREE_ID=DE.ID 	
	WHERE 
		DO.ID=$doctor_id 		
SQL;
    $doctor_results = $db->fetch_all_array($doctor_sql);
    
    
    
    
    $ad_sql=<<<SQL
	SELECT
upperwords(AT.NAME) AS NAME,
upperwords(DS.ADVANCED_TRAINING_COUNTRY) AS ADVANCED_TRAINING_COUNTRY,
upperwords(DS.PROGRAM_NAME) AS PROGRAM_NAME,
upperwords(DS.DESCRIPTION) AS DESCRIPTION,
S.NAME AS SPECIALITY_ID,
DS.FT_PT,
DATE_FORMAT(DS.START_DATE,'%m/%d/%Y') AS START_DATE,
DATE_FORMAT(DS.END_DATE,'%m/%d/%Y') AS END_DATE,
upperwords(DS.ADVANCED_TRAINING_DIRECTOR) AS ADVANCED_TRAINING_DIRECTOR,
upperwords(DS.ADVANCED_TRAINING_CURRENT_DIRECTOR) AS ADVANCED_TRAINING_CURRENT_DIRECTOR,
DS.IS_ADVANCED_TRAINING_COMPLETED,
ADT.NAME AS ADDRESS_TYPE_ID,
upperwords(ADR.ADDRESS_1) AS ADDRESS_1,
upperwords(ADR.CITY) AS CITY,
upperwords(ST.NAME) AS STATE_NAME,
ADR.ZIP AS ZIPCODE,
ADR.PHONE AS PHONE,
ADR.FAX AS FAX FROM
ADVANCED_TRAININGS AT                 
LEFT JOIN DOCTOR_SCHOOLS AS DS ON DS.ADVANCED_TRAINING_ID=AT.ID
LEFT JOIN SPECIALITIES S ON (DS.DOCTOR_SPECIALITY_ID = S.ID)
LEFT JOIN ADDRESSES ADR ON (DS.ADDRESS_ID = ADR.ID)
LEFT JOIN ADDRESS_TYPES ADT ON (ADR.ADDRESS_TYPE_ID = ADT.ID)
LEFT JOIN STATES ST ON (ADR.STATE_ID = ST.ID)	
	WHERE 
		DS.ID=$ad_id 
SQL;
	
        $advancedview=$db->query_first($ad_sql);
        
        
        
        
        //====================== DOCTOR CURRENT WORKHISTORY ===========
$sql = "SELECT
B.LEGAL_NAME AS DOC_PRACTICENAME,
A.OPEN_DATE AS DOC_PRACTICESTARTDATE,
'TILL DATE' AS DOC_PRACTICEENDDATE,
CONCAT(D.ADDRESS_1,' ',IF(D.ADDRESS_2 IS NULL,' ',D.ADDRESS_2)) AS DOC_PRACTICEADDRESS,
D.CITY AS DOC_PRACTICECITY,
E.NAME AS DOC_PRACTICESTATE,
D.ZIP AS DOC_PRACTICEZIP,
D.PHONE AS  DOC_PRACTICEPHONE,
A.JOBTITLE AS DOC_PRACTICEJOBTITLE,
A.REASON_LEAVING AS DOC_PRACTICEREASONLEAVING
FROM WORKHISTORY A
LEFT JOIN PRACTICES B ON (A.PRACTICE_ID = B.ID)
LEFT JOIN PRACTICE_ADDRESSES C ON (B.ID = C.PRACTICE_ID)
LEFT JOIN ADDRESSES D ON (C.PRACTICE_ADDRESS_ID = D.ID)
LEFT JOIN STATES E ON (D.STATE_ID = E.ID)
LEFT JOIN ADDRESS_TYPES F ON (D.ADDRESS_TYPE_ID = F.ID)
WHERE A.DOCTOR_ID = $doctor_id AND (A.END_DATE IS NULL OR A.END_DATE='') 
AND  F.NAME LIKE 'PRIMARY'

UNION

SELECT
IF(A.PREVIOUS_PRACTICE_ID < 1,A.PREVIOUS_PRACTICE_NAME,B.BUSINESS_NAME) AS DOC_PRACTICENAME, 
A.OPEN_DATE AS DOC_PRACTICESTARTDATE,
'TILL DATE' AS DOC_PRACTICEENDDATE,
CONCAT(D.ADDRESS_1,' ',IF(D.ADDRESS_2 IS NULL,' ',D.ADDRESS_2)) AS DOC_PRACTICEADDRESS,
D.CITY AS DOC_PRACTICECITY,
E.NAME AS DOC_PRACTICESTATE,
D.ZIP AS DOC_PRACTICEZIP,
D.PHONE AS  DOC_PRACTICEPHONE,
A.JOBTITLE AS DOC_PRACTICEJOBTITLE,
A.REASON_LEAVING AS DOC_PRACTICEREASONLEAVING
FROM WORKHISTORY A
LEFT JOIN PRACTICES B ON (A.PRACTICE_ID = B.ID)
LEFT JOIN PRACTICE_ADDRESSES C ON (A.ID = C.WORKHISTORY_ID)
LEFT JOIN ADDRESSES D ON (C.WORKHISTORY_ADDRESS_ID = D.ID)
LEFT JOIN STATES E ON (D.STATE_ID = E.ID)
LEFT JOIN ADDRESS_TYPES F ON (D.ADDRESS_TYPE_ID = F.ID)
WHERE A.DOCTOR_ID = $doctor_id AND (A.END_DATE IS NULL OR A.END_DATE='') 
AND  F.NAME LIKE 'PRIMARY'
";
//echo $sql;
$res  = mysql_query($sql);
